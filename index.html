<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="description"
        content="Monitorea tu finca con im√°genes dron de alta resoluci√≥n. AeroFinca Log permite anotar hallazgos, coordinar equipos en campo y optimizar decisiones agr√≠colas.">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Locate.min.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <link rel="stylesheet" href="css/leaflet-search.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="shortcut icon" type="image/png" href="images/favicon.png">
    <!-- Tailwind CSS CDN cargado aqu√≠ para permitir override -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/tailwind.config.js"></script>
    <!-- CSS personalizado despu√©s de Tailwind -->
    <link rel="stylesheet" href="css/custom.css">
    <title>AeroFinca Log - Registra hallazgos y coordina en campo</title>
</head>

<body class="w-full h-screen overflow-hidden font-montserrat bg-white">
    <main class="flex flex-col h-screen bg-white" role="main">
        <header
            class="bg-white text-gray-800 px-6 py-4 h-[70px] flex items-center justify-between shadow-lg z-[1000] relative border-b-[3px] border-teal-600"
            role="banner">
            <div class="absolute inset-0 bg-gradient-to-r from-teal-50 via-white to-blue-50 pointer-events-none">
            </div>
            <div class="flex items-center gap-4 z-10 relative">
                <img src="images/favicon.png" alt="AeroFinca Log" class="w-10 h-10 object-contain">
                <div>
                    <h1 class="m-0 text-2xl font-semibold font-montserrat tracking-tight text-gray-800">AeroFinca Log
                    </h1>
                    <p class="m-0 text-sm text-gray-600 font-medium hidden lg:block">Registra hallazgos y coordina en
                        campo</p>
                </div>
            </div>
            <!-- Bot√≥n hamburguesa para mobile -->
            <button id="mobile-menu-btn"
                class="lg:hidden z-10 relative p-2 rounded-lg hover:bg-teal-50 transition-colors"
                aria-label="Abrir men√∫">
                <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16">
                    </path>
                </svg>
            </button>
        </header>

        <div class="flex flex-1 h-[calc(100vh-70px)] main-content lg:pl-0">
            <aside id="sidebar"
                class="w-80 lg:w-80 bg-white text-gray-700 shadow-xl border-r border-slate-200 flex flex-col fixed lg:relative inset-y-0 left-0 z-[9999] transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out lg:transition-none"
                role="complementary" aria-label="Panel lateral de capas y an√°lisis">
                <!-- Overlay para mobile -->
                <div id="sidebar-overlay"
                    class="fixed inset-0 bg-black bg-opacity-50 z-[-1] lg:hidden opacity-0 pointer-events-none transition-opacity duration-300">
                </div>

                <div class="absolute inset-0 bg-gradient-to-b from-teal-50 via-white to-blue-50 pointer-events-none">
                </div>

                <!-- Header del sidebar con bot√≥n cerrar para mobile -->
                <div
                    class="lg:hidden flex items-center justify-between p-4 border-b border-slate-200 relative z-20 bg-white">
                    <div class="flex items-center gap-3">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Registra hallazgos y coordina en campo</p>
                        </div>
                    </div>
                    <button id="sidebar-close-btn" class="p-2 rounded-lg hover:bg-gray-100 transition-colors"
                        aria-label="Cerrar men√∫">
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <nav class="relative z-20 bg-white flex flex-col h-full" aria-label="Navegaci√≥n de pesta√±as">
                    <ul class="list-none m-0 p-0 flex border-b-2 border-gray-100 bg-white" role="tablist"
                        aria-orientation="horizontal">
                        <li class="flex-1 flex" role="presentation">
                            <button
                                class="tab-button active flex-1 px-2 py-3 bg-transparent border-none text-gray-700 text-sm font-medium font-montserrat cursor-pointer transition-all duration-300 border-b-[3px] border-transparent flex items-center justify-center gap-2 hover:text-gray-800 hover:bg-teal-50 active:text-gray-800 active:font-semibold active:border-teal-600 active:bg-teal-50"
                                id="tab-capas" role="tab" aria-selected="true" aria-controls="capas" tabindex="0">
                                üõ∞Ô∏è Capas
                            </button>
                        </li>
                        <li class="flex-1 flex" role="presentation">
                            <button
                                class="tab-button flex-1 px-2 py-3 bg-transparent border-none text-gray-700 text-sm font-medium font-montserrat cursor-pointer transition-all duration-300 border-b-[3px] border-transparent flex items-center justify-center gap-2 hover:text-gray-800 hover:bg-teal-50"
                                id="tab-analisis" role="tab" aria-selected="false" aria-controls="analisis"
                                tabindex="-1">
                                üìä An√°lisis
                            </button>
                        </li>
                    </ul>

                    <section class="flex-1 overflow-y-auto overflow-x-hidden p-5 relative z-10 min-h-0 sidebar-scroll">
                        <!-- Pesta√±a Capas -->
                        <section id="capas" class="tab-panel active block sidebar-content" role="tabpanel"
                            aria-labelledby="tab-capas">
                            <section class="mb-6 relative z-10">
                                <h2
                                    class="mb-4 text-gray-800 text-base font-semibold font-montserrat border-b-2 border-teal-600 pb-2 relative uppercase tracking-wide z-10 after:content-[''] after:absolute after:-bottom-0.5 after:left-0 after:w-8 after:h-0.5 after:bg-gradient-to-r after:from-teal-600 after:to-blue-500 after:rounded-sm">
                                    Capas Base</h2>
                                <div
                                    class="py-2.5 border-b border-slate-200 font-normal leading-relaxed transition-all duration-300 relative z-10 text-gray-700 text-sm flex items-center gap-2.5 cursor-pointer select-none hover:pl-4 hover:text-gray-800 hover:bg-teal-50 hover:-mx-2.5 hover:pr-2.5 hover:rounded-md hover:border-transparent">
                                    <input type="checkbox" id="GoogleSatelliteHybrid" checked aria-checked="true"
                                        class="w-[18px] h-[18px] accent-teal-600 cursor-pointer hover:scale-110 disabled:opacity-60 disabled:cursor-not-allowed">
                                    <label for="GoogleSatelliteHybrid" class="flex-1 cursor-pointer text-sm">üõ∞Ô∏è Google
                                        Satellite Hybrid</label>
                                </div>
                            </section>
                            <section class="mb-6 relative z-10">
                                <h2
                                    class="mb-4 text-gray-800 text-base font-semibold font-montserrat border-b-2 border-teal-600 pb-2 relative uppercase tracking-wide z-10 after:content-[''] after:absolute after:-bottom-0.5 after:left-0 after:w-8 after:h-0.5 after:bg-gradient-to-r after:from-teal-600 after:to-blue-500 after:rounded-sm">
                                    Datos Vectoriales</h2>
                                <div
                                    class="py-2.5 border-b border-slate-200 font-normal leading-relaxed transition-all duration-300 relative z-10 text-gray-700 text-sm flex items-center gap-2.5 cursor-pointer select-none hover:pl-4 hover:text-gray-800 hover:bg-teal-50 hover:-mx-2.5 hover:pr-2.5 hover:rounded-md hover:border-transparent">
                                    <input type="checkbox" id="Potreros" checked aria-checked="true"
                                        class="w-[18px] h-[18px] accent-teal-600 cursor-pointer hover:scale-110 disabled:opacity-60 disabled:cursor-not-allowed">
                                    <label for="Potreros" class="flex-1 cursor-pointer text-sm">üü© Potreros</label>
                                </div>
                            </section>

                            <!-- Footer con copyright -->
                            <footer class="mt-8 pt-4 border-t border-slate-200 relative z-10">
                                <div class="text-center text-xs text-gray-500 mb-2">
                                    ¬© 2025 GIRA - Grupo de Investigaci√≥n en<br>
                                    Recursos Agr√≠colas
                                </div>
                            </footer>
                        </section>

                        <!-- Pesta√±a An√°lisis -->
                        <section id="analisis" class="tab-panel sidebar-content" role="tabpanel"
                            aria-labelledby="tab-analisis" hidden>
                            <section class="mb-6 relative z-10">
                                <h2
                                    class="mb-4 text-gray-800 text-base font-semibold font-montserrat border-b-2 border-teal-600 pb-2 relative uppercase tracking-wide z-10 after:content-[''] after:absolute after:-bottom-0.5 after:left-0 after:w-8 after:h-0.5 after:bg-gradient-to-r after:from-teal-600 after:to-blue-500 after:rounded-sm">
                                    Informaci√≥n del Proyecto</h2>
                                <div
                                    class="py-2.5 border-b border-slate-200 font-normal leading-relaxed transition-all duration-300 relative z-10 text-gray-700 text-sm">
                                    <strong>Cultivo:</strong> Ca√±a de Az√∫car
                                </div>
                                <div
                                    class="py-2.5 border-b border-slate-200 font-normal leading-relaxed transition-all duration-300 relative z-10 text-gray-700 text-sm">
                                    <strong>Fotocentros:</strong> 206 Im√°genes
                                </div>
                                <!-- Filtro de Potreros -->
                                <div class="py-2.5 border-b border-slate-200 font-normal leading-relaxed transition-all duration-300 relative z-10 text-gray-700 text-sm">
                                    <label for="select-potreros" class="block text-sm font-medium text-gray-700 mb-2">Filtrar Potreros</label>
                                    <select id="select-potreros" class="w-full text-sm p-2 border border-slate-200 rounded-md bg-white">
                                        <option value="">-- Seleccione un potrero --</option>
                                    </select>
                                </div>
                            </section>
                            <section class="mb-6 relative z-10">
                                <h2
                                    class="mb-4 text-gray-800 text-base font-semibold font-montserrat border-b-2 border-teal-600 pb-2 relative uppercase tracking-wide z-10 after:content-[''] after:absolute after:-bottom-0.5 after:left-0 after:w-8 after:h-0.5 after:bg-gradient-to-r after:from-teal-600 after:to-blue-500 after:rounded-sm">
                                    Imagen</h2>
                                <div id="selected-fotocentro-info" class="fotocentro-info" style="display: none;">
                                    üìç Fotocentro seleccionado: <span id="fotocentro-code"></span>
                                </div>
                                <div id="image-viewer" class="image-viewer" aria-live="polite">
                                    <div class="image-placeholder" aria-label="Imagen no seleccionada">
                                        <span style="font-size: 24px;">üì∑</span>
                                        <span>Haz clic en un fotocentro del mapa para ver su imagen</span>
                                    </div>
                                </div>
                                <!-- Controles de marcaci√≥n y notas y validaci√≥n (con IDs requeridos por JS) -->
                                <div id="fotocentro-actions" style="display:none">
                                    <div class="section">
                                        <div class="section-title">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                                <path
                                                    d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                                            </svg>
                                            Observaciones
                                        </div>

                                        <!-- Card de nota guardada -->
                                        <div id="note-card"
                                            class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg shadow-sm"
                                            style="display:none">
                                            <div class="flex items-start gap-3">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"
                                                    class="text-blue-600 mt-0.5 flex-shrink-0">
                                                    <path
                                                        d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                                                </svg>
                                                <div class="flex-1">
                                                    <div class="text-blue-800 font-medium text-sm mb-2">Observaci√≥n
                                                        registrada</div>
                                                    <div id="note-text"
                                                        class="text-gray-700 text-base leading-relaxed mb-3"></div>
                                                    <div class="flex gap-2">
                                                        <button id="btn-edit-note"
                                                            class="inline-flex items-center gap-1 text-blue-600 hover:text-blue-800 text-sm font-medium border border-blue-300 hover:border-blue-400 px-3 py-1.5 rounded-md bg-white hover:bg-blue-50 transition">
                                                            <svg width="14" height="14" viewBox="0 0 24 24"
                                                                fill="currentColor">
                                                                <path
                                                                    d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" />
                                                            </svg>
                                                            Actualizar
                                                        </button>
                                                        <button id="btn-delete-note"
                                                            class="inline-flex items-center gap-1 text-red-600 hover:text-red-800 text-sm font-medium border border-red-300 hover:border-red-400 px-3 py-1.5 rounded-md bg-white hover:bg-red-50 transition">
                                                            <svg width="14" height="14" viewBox="0 0 24 24"
                                                                fill="currentColor">
                                                                <path
                                                                    d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                                                            </svg>
                                                            Borrar
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Bot√≥n para agregar observaci√≥n -->
                                        <div id="add-note-btn-container">
                                            <button id="btn-add-note"
                                                class="flex items-center gap-2 w-full justify-center bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg px-4 py-3 shadow-sm transition">
                                                <svg viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                                                    <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />
                                                </svg>
                                                Agregar Observaci√≥n
                                            </button>
                                        </div>

                                        <!-- Formulario de observaciones (inicialmente oculto) -->
                                        <div class="notes-container" id="note-section" style="display:none">
                                            <div class="text-gray-600 text-sm mb-3 font-medium">
                                                üí° Ingrese la observaci√≥n t√©cnica sobre este fotocentro:
                                            </div>
                                            <textarea id="fotocentro-note"
                                                placeholder="Describa las anomal√≠as detectadas..."
                                                class="w-full min-h-[100px] max-h-[160px] resize-y border border-gray-300 rounded-lg p-3 text-base font-normal text-gray-800 bg-white mb-3 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 focus:outline-none transition"></textarea>
                                            <div class="flex gap-2">
                                                <button id="btn-save-note"
                                                    class="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg px-4 py-2.5 shadow-sm transition">
                                                    <svg viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4">
                                                        <path
                                                            d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z" />
                                                    </svg>
                                                    Guardar
                                                </button>
                                                <button id="btn-cancel-note"
                                                    class="flex items-center gap-2 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg px-4 py-2.5 shadow-sm transition">
                                                    <svg viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4">
                                                        <path
                                                            d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
                                                    </svg>
                                                    Cancelar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="section hidden">
                                        <div class="section-title">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                                <path
                                                    d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z" />
                                            </svg>
                                            Acciones de Validaci√≥n
                                        </div>

                                        <!-- Texto explicativo de alerta -->
                                        <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4">
                                            <div class="flex items-start gap-2">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"
                                                    class="text-amber-600 mt-0.5 flex-shrink-0">
                                                    <path
                                                        d="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" />
                                                </svg>
                                                <div class="text-amber-800 text-sm">
                                                    <p class="font-medium mb-1">Marque el estado del fotocentro:</p>
                                                    <p class="text-xs leading-relaxed">Use "Problem√°tico" para anomal√≠as
                                                        graves observadas, o "Revisar" para casos que necesitan
                                                        verificaci√≥n en campo.</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-3 my-2">
                                            <button id="btn-problem" type="button"
                                                class="flex items-center justify-center gap-2 px-4 py-2 rounded-lg border-2 border-red-400 text-red-600 bg-red-50 font-semibold text-base shadow-sm transition focus:outline-none focus:ring-2 focus:ring-blue-400">
                                                <svg viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                                                    <path
                                                        d="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" />
                                                </svg>
                                                Problem√°tico
                                            </button>
                                            <button id="btn-attention" type="button"
                                                class="flex items-center justify-center gap-2 px-4 py-2 rounded-lg border-2 border-orange-400 text-orange-600 bg-orange-50 font-semibold text-base shadow-sm transition focus:outline-none focus:ring-2 focus:ring-blue-400">
                                                <svg viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                                                    <path
                                                        d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,7A1.5,1.5 0 0,1 13.5,8.5A1.5,1.5 0 0,1 12,10A1.5,1.5 0 0,1 10.5,8.5A1.5,1.5 0 0,1 12,7M12,17C9.5,17 7.5,15 7.5,12.5C7.5,11.77 7.64,11.07 7.87,10.43L10.88,14.85C11.28,15.68 12,16 12,16C12,16 12.72,15.68 13.12,14.85L16.13,10.43C16.36,11.07 16.5,11.77 16.5,12.5C16.5,15 14.5,17 12,17Z" />
                                                </svg>
                                                Revisar
                                            </button>
                                        </div>
                                        <div id="validation-status" class="text-center text-xs text-gray-500 mt-2"
                                            style="display:none"></div>
                                    </div>
                                </div>
                            </section>

                            <section class="mb-6 relative z-10">
                                <h2
                                    class="mb-4 text-gray-800 text-base font-semibold font-montserrat border-b-2 border-teal-600 pb-2 relative uppercase tracking-wide z-10 after:content-[''] after:absolute after:-bottom-0.5 after:left-0 after:w-8 after:h-0.5 after:bg-gradient-to-r after:from-teal-600 after:to-blue-500 after:rounded-sm">
                                    Gr√°fico</h2>
                                <div id="chart-viewer" class="chart-viewer" aria-live="polite">
                                    <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                                        <div class="text-center mb-4">
                                            <h3 class="text-sm font-semibold text-gray-800 mb-1">√çndice de
                                                establecimiento</h3>
                                            <p class="text-xs text-gray-500">Total: 77,023 plantas</p>
                                        </div>

                                        <!-- Gr√°fico de torta SVG -->
                                        <div class="flex justify-center mb-4 relative">
                                            <svg width="180" height="180" viewBox="-90 -90 180 180"
                                                class="transform -rotate-90">
                                                <!-- Poblado - Buen vigor: 74.5% (57,382 plantas) -->
                                                <circle cx="0" cy="0" r="60" fill="none" stroke="#10b981"
                                                    stroke-width="35" stroke-dasharray="280.2 96.8"
                                                    stroke-dashoffset="0" opacity="0.9"
                                                    class="cursor-pointer transition-opacity duration-200 hover:opacity-100"
                                                    data-category="Poblado - Buen vigor" data-percentage="74.5%"
                                                    data-count="57,382 plantas" onmouseover="showTooltip(event, this)"
                                                    onmouseout="hideTooltip()" />

                                                <!-- Poblado - Bajo vigor: 15.7% (12,093 plantas) -->
                                                <circle cx="0" cy="0" r="60" fill="none" stroke="#f59e0b"
                                                    stroke-width="35" stroke-dasharray="59.1 317.9"
                                                    stroke-dashoffset="-280.2" opacity="0.9"
                                                    class="cursor-pointer transition-opacity duration-200 hover:opacity-100"
                                                    data-category="Poblado - Bajo vigor" data-percentage="15.7%"
                                                    data-count="12,093 plantas" onmouseover="showTooltip(event, this)"
                                                    onmouseout="hideTooltip()" />

                                                <!-- Despoblado: 9.8% (7,548 plantas) -->
                                                <circle cx="0" cy="0" r="60" fill="none" stroke="#ef4444"
                                                    stroke-width="35" stroke-dasharray="36.9 340.1"
                                                    stroke-dashoffset="-339.3" opacity="0.9"
                                                    class="cursor-pointer transition-opacity duration-200 hover:opacity-100"
                                                    data-category="Despoblado" data-percentage="9.8%"
                                                    data-count="7,548 plantas" onmouseover="showTooltip(event, this)"
                                                    onmouseout="hideTooltip()" />
                                            </svg>

                                            <!-- Tooltip -->
                                            <div id="chart-tooltip"
                                                class="absolute z-50 bg-gray-800 text-white text-xs rounded-lg px-2 py-1 shadow-lg pointer-events-none opacity-0 transition-opacity duration-200"
                                                style="display: none;">
                                                <div class="font-semibold" id="tooltip-percentage"></div>
                                            </div>
                                        </div>

                                        <!-- Leyenda -->
                                        <div class="space-y-2">
                                            <div class="flex items-center justify-between text-xs">
                                                <div class="flex items-center gap-2">
                                                    <div class="w-3 h-3 bg-emerald-500 rounded-full"></div>
                                                    <span class="text-gray-700">Poblado (Rebrotes buen vigor)</span>
                                                </div>
                                                <div class="text-right">
                                                    <div class="font-semibold text-gray-800">74.5%</div>
                                                    <div class="text-gray-500">57,382 plantas</div>
                                                </div>
                                            </div>

                                            <div class="flex items-center justify-between text-xs">
                                                <div class="flex items-center gap-2">
                                                    <div class="w-3 h-3 bg-amber-500 rounded-full"></div>
                                                    <span class="text-gray-700">Poblado (Rebrotes bajo vigor)</span>
                                                </div>
                                                <div class="text-right">
                                                    <div class="font-semibold text-gray-800">15.7%</div>
                                                    <div class="text-gray-500">12,093 plantas</div>
                                                </div>
                                            </div>

                                            <div class="flex items-center justify-between text-xs">
                                                <div class="flex items-center gap-2">
                                                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                                    <span class="text-gray-700">Despoblado</span>
                                                </div>
                                                <div class="text-right">
                                                    <div class="font-semibold text-gray-800">9.8%</div>
                                                    <div class="text-gray-500">7,548 plantas</div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Informaci√≥n adicional -->
                                        <div class="mt-4 pt-3 border-t border-gray-100">
                                            <div class="text-xs text-gray-500 text-center">
                                                üìä An√°lisis basado en im√°genes con sensores RGB + Multiespectral a bordo
                                                de drones.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </section>
                    </section>
                </nav>
            </aside>

            <section id="map" class="flex-1 h-full w-full bg-white lg:ml-0" tabindex="0"
                aria-label="Mapa interactivo principal">
            </section>
        </div>
    </main>
    <!-- Scripts de librer√≠as -->
    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/L.Control.Locate.min.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="js/leaflet-search.js"></script>
    <!-- Eliminadas referencias a archivos locales de 'data/'. Ahora solo se consume el endpoint externo. -->
    <script src="js/main.js"></script>
    <!-- Script de inicializaci√≥n mejorado -->
    <script src="js/init.js"></script>

    <!-- Script para tooltips del gr√°fico -->
    <script>
        function showTooltip(event, element) {
            const tooltip = document.getElementById('chart-tooltip');
            const percentage = element.getAttribute('data-percentage');

            // Actualizar contenido del tooltip (solo porcentaje)
            document.getElementById('tooltip-percentage').textContent = percentage;

            // Mostrar tooltip
            tooltip.style.display = 'block';
            tooltip.classList.remove('opacity-0');
            tooltip.classList.add('opacity-100');

            // Posicionar tooltip dentro del contenedor del gr√°fico
            const chartContainer = event.currentTarget.closest('.relative');
            const rect = chartContainer.getBoundingClientRect();
            const mouseX = event.clientX - rect.left;
            const mouseY = event.clientY - rect.top;

            // Obtener dimensiones del tooltip
            const tooltipRect = tooltip.getBoundingClientRect();
            const tooltipWidth = 40; // Aproximado para el ancho del porcentaje
            const tooltipHeight = 25; // Aproximado para la altura

            // Calcular posici√≥n evitando que se salga del contenedor
            let tooltipX = mouseX + 10;
            let tooltipY = mouseY - 10;

            // Ajustar horizontalmente para mantenerse dentro del sidebar
            if (tooltipX + tooltipWidth > chartContainer.offsetWidth) {
                tooltipX = mouseX - tooltipWidth - 10;
            }
            if (tooltipX < 0) {
                tooltipX = 5;
            }

            // Ajustar verticalmente
            if (tooltipY < 0) {
                tooltipY = mouseY + 15;
            }
            if (tooltipY + tooltipHeight > chartContainer.offsetHeight) {
                tooltipY = chartContainer.offsetHeight - tooltipHeight - 5;
            }

            tooltip.style.left = tooltipX + 'px';
            tooltip.style.top = tooltipY + 'px';
        }

        function hideTooltip() {
            const tooltip = document.getElementById('chart-tooltip');
            tooltip.classList.remove('opacity-100');
            tooltip.classList.add('opacity-0');

            // Ocultar despu√©s de la transici√≥n
            setTimeout(() => {
                if (tooltip.classList.contains('opacity-0')) {
                    tooltip.style.display = 'none';
                }
            }, 200);
        }
    </script>
</body>

</html>